local Path = {}
local PathfindingService = game:GetService("PathfindingService")
local Players = game:GetService("Players")

function Path.createPath(character, destination, settings)
    local path = PathfindingService:CreatePath(settings or {
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true,
        AgentJumpHeight = 7,
        AgentMaxSlope = 45
    })

    -- Asegur√°ndonos de que usamos HumanoidRootPart y no PrimaryPart
    local startPosition = character:FindFirstChild("HumanoidRootPart")
    if not startPosition then
        warn("No HumanoidRootPart found for character!")
        return nil
    end

    -- Intentar calcular el path con pcall para manejar errores
    local success, err = pcall(function()
        path:ComputeAsync(startPosition.Position, destination)
    end)

    if not success then
        warn("Error al calcular el path: " .. err)
        return nil
    end
    
    return path
end

function Path.followPath(character, path)
    if path.Status ~= Enum.PathStatus.Complete then
        warn("Path no completado correctamente.")
        return false
    end
    local waypoints = path:GetWaypoints()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    
    if not humanoid then return false end
    
    for _, waypoint in ipairs(waypoints) do
        if waypoint.Action == Enum.PathWaypointAction.Jump then
            humanoid.Jump = true
        end
        humanoid:MoveTo(waypoint.Position)
        humanoid.MoveToFinished:Wait()
    end
    
    return true
end

return Path
